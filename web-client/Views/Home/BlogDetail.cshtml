@using static web_client.Helpers.Shared.PredefineDataConst
@model ArticleTitleMediaDetailComponent
@inject ILayoutAppService _layout
@inject INewsAppService _newService
@inject INewsCategoryAppService _newCategoryService
@{
    var layoutData = await _layout.GetSystemConfigurationsAsync(new GetAllSystemConfigurationRequest());
    var aboutUs = _layout.GetSystemConfigurationValueLocal(layoutData?.Data, SystemConfigurationKeys.Key.SidebarAboutus, "Mô tả giới thiệu ngắn gọn...");

    var pageModel = new PageModel() { Title = "Chi tiết tin tức", Description = "Mô ta seo tin tức", BodyClassName = "p-blog-detail", MainClassName = "shop" }; ;
    ViewData["Page"] = pageModel;
    var breadcrumbModel = new BreadcrumbComponent(pageModel.Title, new List<BaseLinkModel>()
    {
        new BaseLinkModel("Trang chủ","/"),
        new BaseLinkModel(pageModel.Title,"/Home/Blog"),
        new BaseLinkModel("Chi tiết","/Home/BlogDetail"),
    });
    var _newCategoryResponse = await _newCategoryService.GetAllAsync(CancellationToken.None);
    var sideBarCategoryModel = new CategoryTitleLinksComponent("Danh mục", _newCategoryResponse?.Data?.Select(x => new BaseCategoryItemModel()
            {
                Id = x.Id,
                Media = x?.Image?.Path,
                Title = x.Name,
                Href = string.Format(RouteConst.GetRoute(RouteConst.NewsCategory), x.PageKeyName),
            }).ToList());

    var newsFeatures = await _newService.GetFeatureAsync(3, CancellationToken.None);
    var sideBarArticleModel = new ArticleTitleLinksComponent("Bài viết nổi bật", newsFeatures?.Data?.Select(x => new BaseArticleItemModel()
            {
                CreatedAt = x.CreatedAt,
                CreatedBy = new BaseMediaLinkModel($"{x.CreatedByModel?.Label}", $"{x.CreatedByModel?.Key}"),
                ShortDescription = x.ShortDescription,
                Group = new BaseMediaLinkModel($"{x.ParentIdModel?.Label}", $"{x.ParentIdModel?.Key}"),
                Href = string.Format(RouteConst.GetRoute(RouteConst.NewsDetail), x.PageKeyName),
                Media = x?.Image?.Path,
                Id = x.Id,
                Title = x.Name,
            }).ToList());

    var relativeResponse = await _newService.GetRelativeAsync(Model.Id, CancellationToken.None);
    var relativeModel = new ArticleTitleLinksComponent()
            {
                Title = "Tin liên quan",
                Links = relativeResponse?.Data?.Select(x => new BaseArticleItemModel()
                {
                    CreatedAt = x.CreatedAt,
                    CreatedBy = new BaseMediaLinkModel($"{x.CreatedByModel?.Label}", $"{x.CreatedByModel?.Key}"),
                    ShortDescription = x.ShortDescription,
                    Group = new BaseMediaLinkModel($"{x.ParentIdModel?.Label}", $"{x.ParentIdModel?.Key}"),
                    Href = string.Format(RouteConst.GetRoute(RouteConst.NewsDetail), x.PageKeyName),
                    Media = x?.Image?.Path,
                    Id = x.Id,
                    Title = x.Name,
                }).ToList()
            };
}
@(await Html.PartialAsync("~/Views/Shared/Components/Common/Breadcrumb.cshtml", breadcrumbModel))
<div class="container py-4">
    <div class="row">
        <div class="col-lg-3 order-lg-2">
            <aside class="sidebar">
                <div class="card card-border card-border-bottom bg-color-light mb-4">
                    <div class="card-body p-3">
                        @(await Html.PartialAsync("~/Views/Shared/Components/Common/SideBarCategoryTitleList.cshtml", sideBarCategoryModel))
                    </div>
                </div>

                <div class="card card-border card-border-bottom bg-color-light mb-4">
                    <div class="card-body p-3">
                        @(await Html.PartialAsync("~/Views/Shared/Components/Common/SideBarArticleTitleList.cshtml", sideBarArticleModel))
                    </div>
                </div>

                @if (aboutUs?.HasValueString() == true)
                {
                    <div class="card card-border card-border-bottom bg-color-light mb-4">
                        <div class="card-body p-3">
                            @(await Html.PartialAsync("~/Views/Shared/Components/Common/SideBarContentTitleLink.cshtml", new ContentTitleLinkComponent("Giới thiệu", aboutUs, new BaseCategoryItemModel("Tìm hiểu thêm", "#"))))
                        </div>
                    </div>
                }
            </aside>
        </div>
        <div class="col-lg-9 order-lg-1">
            <div class="blog-posts single-post mb-4">
                <article class="post post-large blog-single-post border-0 m-0 p-0">
                    <div class="post-image ms-0">
                        <a href="blog-post.html">
                            <img src="@Model?.Media" class="img-fluid img-thumbnail img-thumbnail-no-borders rounded-0" alt="@Model?.Title">
                        </a>
                    </div>

                    @* <div class="post-date ms-0">
                        <span class="day">10</span>
                        <span class="month">Jan</span>
                    </div> *@

                    <div class="post-content ms-0">
                        <h2 class="font-weight-semi-bold"><a href="@Model?.Href">@Model?.Title</a></h2>
                        <div class="post-meta">
                            @if (Model?.CreatedAt?.HasValueDate() == true)
                            {
                                <span><i class="far fa-calendar"></i>@Html.DisplayFor(x => Model.CreatedAt)</span>
                            }
                            @if (Model?.CreatedBy?.Title?.HasValueString() == true)
                            {
                                <span><i class="far fa-user"></i> <a href="#">@Model?.CreatedBy?.Title</a> </span>
                            }
                            @if (Model?.Group?.Title?.HasValueString() == true)
                            {
                                <span><i class="far fa-folder"></i> <a href="#">@Model?.Group?.Title</a></span>
                            }

                        </div>
                        <div class="ck-content" id="single-content" data-title="Mục lục">
                            @Html.Raw(Model?.Content)
                        </div>
                        <div class="post-block mt-5 post-share">
                            <h4 class="mb-3">Chia sẻ</h4>

                            <!-- Go to www.addtoany.com to customize -->
                            <!-- AddToAny BEGIN -->
                            <div class="a2a_kit a2a_kit_size_32 a2a_default_style" style="line-height: 32px;">
                                <a class="a2a_dd" href="https://www.addtoany.com/share#url=https%3A%2F%2Fwww.okler.net%2Fpreviews%2Fporto%2F12.1.0%2Fblog-post-sidebar-right.html&amp;title=Post%20Right%20Sidebar%20%7C%20Porto%20-%20Multipurpose%20Website%20Template"><span class="a2a_svg a2a_s__default a2a_s_a2a" style="background-color: rgb(1, 102, 255);"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><g fill="#FFF"><path d="M14 7h4v18h-4z"></path><path d="M7 14h18v4H7z"></path></g></svg></span><span class="a2a_label a2a_localize" data-a2a-localize="inner,Share">Share</span></a>
                                <a class="a2a_button_facebook" target="_blank" rel="nofollow noopener" href="/#facebook"><span class="a2a_svg a2a_s__default a2a_s_facebook" style="background-color: rgb(8, 102, 255);"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="#fff" d="M28 16c0-6.627-5.373-12-12-12S4 9.373 4 16c0 5.628 3.875 10.35 9.101 11.647v-7.98h-2.474V16H13.1v-1.58c0-4.085 1.849-5.978 5.859-5.978.76 0 2.072.15 2.608.298v3.325c-.283-.03-.775-.045-1.386-.045-1.967 0-2.728.745-2.728 2.683V16h3.92l-.673 3.667h-3.247v8.245C23.395 27.195 28 22.135 28 16"></path></svg></span><span class="a2a_label">Facebook</span></a>
                                <a class="a2a_button_x" target="_blank" rel="nofollow noopener" href="/#x"><span class="a2a_svg a2a_s__default a2a_s_x" style="background-color: rgb(26, 26, 26);"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="#fff" d="M21.751 7h3.067l-6.7 7.658L26 25.078h-6.172l-4.833-6.32-5.531 6.32h-3.07l7.167-8.19L6 7h6.328l4.37 5.777L21.75 7Zm-1.076 16.242h1.7L11.404 8.74H9.58l11.094 14.503Z"></path></svg></span><span class="a2a_label">X</span></a>
                                <a class="a2a_button_copy_link" target="_blank" rel="nofollow noopener" href="/#copy_link"><span class="a2a_svg a2a_s__default a2a_s_link" style="background-color: rgb(136, 137, 144);"><svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="#fff" d="M7.591 21.177q0-.54.377-.917l2.804-2.804a1.24 1.24 0 0 1 .913-.378q.565 0 .97.43-.038.041-.255.25-.215.21-.29.29a3 3 0 0 0-.2.256 1.1 1.1 0 0 0-.177.344 1.4 1.4 0 0 0-.046.37q0 .54.377.918a1.25 1.25 0 0 0 .918.377q.19.001.373-.047.189-.056.345-.175.135-.09.256-.2.15-.14.29-.29c.14-.142.223-.23.25-.254q.445.42.445.984 0 .539-.377.916l-2.778 2.79a1.24 1.24 0 0 1-.917.364q-.54-.001-.917-.35l-1.982-1.97a1.22 1.22 0 0 1-.378-.9zm9.477-9.504q0-.54.377-.917l2.777-2.79a1.24 1.24 0 0 1 .913-.378q.525-.001.917.364l1.984 1.968q.38.378.38.903 0 .54-.38.917l-2.802 2.804a1.24 1.24 0 0 1-.916.364q-.565 0-.97-.418.038-.04.255-.25a8 8 0 0 0 .29-.29q.108-.12.2-.255.121-.156.176-.344.048-.181.047-.37 0-.538-.377-.914a1.25 1.25 0 0 0-.917-.377q-.205 0-.37.046-.172.046-.346.175a4 4 0 0 0-.256.2q-.08.076-.29.29l-.25.258q-.441-.417-.442-.983zM5.003 21.177q0 1.617 1.146 2.736l1.982 1.968c.745.75 1.658 1.12 2.736 1.12q1.63 0 2.75-1.143l2.777-2.79c.75-.747 1.12-1.66 1.12-2.737q.002-1.66-1.183-2.818l1.186-1.185q1.16 1.185 2.805 1.186 1.617 0 2.75-1.13l2.803-2.81q1.127-1.132 1.128-2.748 0-1.62-1.146-2.738L23.875 6.12Q22.758 4.999 21.139 5q-1.63 0-2.75 1.146l-2.777 2.79c-.75.747-1.12 1.66-1.12 2.737q-.002 1.658 1.183 2.817l-1.186 1.186q-1.16-1.186-2.805-1.186-1.617 0-2.75 1.132L6.13 18.426Q5 19.559 5 21.176z"></path></svg></span><span class="a2a_label">Copy Link</span></a>
                                <div style="clear: both;"></div>
                            </div>
                            <script async="" src="https://static.addtoany.com/menu/page.js"></script>
                            <!-- AddToAny END -->

                        </div>
                    </div>
                </article>
            </div>

            <div class="card border-radius-2 bg-color-light border-0 box-shadow-1 mb-4">
                <div class="card-body">
                    <div class="article-relative">
                        @await Html.PartialAsync("~/Views/Shared/Components/Common/SliderArticleTitleListStyle2.cshtml", relativeModel)
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>